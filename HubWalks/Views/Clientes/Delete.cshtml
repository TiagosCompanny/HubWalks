@model HubWalks.Bussines.Models.Cliente
@using System.Text.RegularExpressions

@{
    ViewData["Title"] = "Excluir Cliente";

    string FormatCpfCnpj(string v)
    {
        if (string.IsNullOrWhiteSpace(v)) return "";
        var d = new string(v.Where(char.IsDigit).ToArray());
        if (d.Length == 11) return Regex.Replace(d, @"(\d{3})(\d{3})(\d{3})(\d{2})", "$1.$2.$3-$4");
        if (d.Length == 14) return Regex.Replace(d, @"(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})", "$1.$2.$3/$4-$5");
        return v;
    }
}

<div class="container">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h3 m-0">Excluir Cliente</h1>
        <div class="d-flex gap-2">
            <a asp-action="Edit" asp-route-id="@Model.IdCliente" class="btn btn-outline-primary">Editar</a>
            <a asp-action="Index" class="btn btn-secondary">Voltar</a>
        </div>
    </div>

    <div class="alert alert-danger d-flex align-items-start" role="alert">
        <div class="me-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16" aria-hidden="true">
                <path d="M7.938 2.016a1.13 1.13 0 0 1 2.02 0l6.857 11.667c.457.775-.091 1.75-1.01 1.75H2.093c-.918 0-1.467-.975-1.01-1.75L7.938 2.016zM8 5c-.535 0-.954.462-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 5m0 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2" />
            </svg>
        </div>
        <div>
            <strong>Atenção:</strong> esta ação é permanente. O cliente <strong>@Model.NomeCliente</strong> será removido e não poderá ser recuperado.
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">Nome</dt>
                <dd class="col-sm-9">@Model.NomeCliente</dd>

                <dt class="col-sm-3">CPF/CNPJ</dt>
                <dd class="col-sm-9">@FormatCpfCnpj(Model.CpfCnpj)</dd>

                <dt class="col-sm-3">E-mail</dt>
                <dd class="col-sm-9">@Model.Email</dd>

                <dt class="col-sm-3">Telefone</dt>
                <dd class="col-sm-9">@Model.NumeroTelefone</dd>

                <dt class="col-sm-3">Endereço</dt>
                <dd class="col-sm-9">@Model.Endereco</dd>
            </dl>
        </div>
    </div>

    <div class="accordion mb-4" id="accordionMaisDetalhes">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingDetalhes">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDetalhes" aria-expanded="false" aria-controls="collapseDetalhes">
                    Mais detalhes do cliente
                </button>
            </h2>
            <div id="collapseDetalhes" class="accordion-collapse collapse" aria-labelledby="headingDetalhes" data-bs-parent="#accordionMaisDetalhes">
                <div class="accordion-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-3">Data de Nascimento</dt>
                        <dd class="col-sm-9">@Html.DisplayFor(m => m.DataNascimento)</dd>

                        <dt class="col-sm-3">Site Oficial</dt>
                        <dd class="col-sm-9">@Model.SiteOficial</dd>

                        <dt class="col-sm-3">Instagram</dt>
                        <dd class="col-sm-9">@Model.Instagram</dd>

                        <dt class="col-sm-3">Rede Social 1</dt>
                        <dd class="col-sm-9">@Model.RedeSocial_1</dd>

                        <dt class="col-sm-3">Rede Social 2</dt>
                        <dd class="col-sm-9">@Model.RedeSocial_2</dd>

                        <dt class="col-sm-3">Cadastro</dt>
                        <dd class="col-sm-9">@Html.DisplayFor(m => m.DataCadastro)</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Botão que abre o modal de confirmação -->
    <div class="d-flex gap-2">
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
            Excluir Cliente
        </button>
        <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
    </div>
</div>

<!-- Modal de confirmação -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="confirmDeleteLabel">Confirmar exclusão</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                Tem certeza que deseja excluir o cliente <strong>@Model.NomeCliente</strong>?<br />
                <small class="text-muted">Esta ação não poderá ser desfeita.</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Voltar</button>

                <!-- O POST real acontece aqui -->
                <form asp-action="Delete" method="post" class="d-inline" id="deleteForm">
                    @* Em projetos scaffold padrão, o POST de Delete costuma usar [HttpPost, ActionName("Delete")] *@
                    <input type="hidden" asp-for="IdCliente" />
                    <button type="submit" class="btn btn-danger" id="confirmDeleteBtn">Excluir definitivamente</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            // Foco no botão de confirmação quando o modal abrir
            const modal = document.getElementById('confirmDeleteModal');
            modal?.addEventListener('shown.bs.modal', function () {
                document.getElementById('confirmDeleteBtn')?.focus();
            });

            // Evitar duplo submit
            document.getElementById('deleteForm')?.addEventListener('submit', function (e) {
                const btn = document.getElementById('confirmDeleteBtn');
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'Excluindo...';
                }
            });
        })();
    </script>
}
