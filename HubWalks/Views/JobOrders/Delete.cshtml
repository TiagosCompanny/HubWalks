@model HubWalks.Bussines.Models.JobOrder

@{
    ViewData["Title"] = "Excluir Ordem de Serviço";
}

<div class="container">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h3 m-0">Excluir Ordem de Serviço</h1>
        <a asp-action="Index" class="btn btn-secondary">Voltar</a>
    </div>

    <div class="alert alert-danger d-flex align-items-start" role="alert">
        <div class="me-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                <path d="M7.938 2.016a1.13 1.13 0 0 1 2.02 0l6.857 11.667c.457.775-.091 1.75-1.01 1.75H2.093c-.918 0-1.467-.975-1.01-1.75L7.938 2.016zM8 5c-.535 0-.954.462-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 5m0 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2" />
            </svg>
        </div>
        <div>
            <strong>Atenção:</strong> esta ação é permanente. A ordem de serviço <strong>@Model.NomeProjeto</strong> será removida e não poderá ser recuperada.
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">Nome do Projeto</dt>
                <dd class="col-sm-9">@Model.NomeProjeto</dd>

                <dt class="col-sm-3">Cliente</dt>
                <dd class="col-sm-9">@Model.Cliente?.NomeCliente</dd>

                <dt class="col-sm-3">Closer</dt>
                <dd class="col-sm-9">@Model.Closer</dd>

                <dt class="col-sm-3">SDR/BDR</dt>
                <dd class="col-sm-9">@Model.SdrBdr?.Nome</dd>

                <dt class="col-sm-3">Data da Solicitação</dt>
                <dd class="col-sm-9">@Model.DataSolicitacao.ToString("dd/MM/yyyy HH:mm")</dd>

                <dt class="col-sm-3">Prazo</dt>
                <dd class="col-sm-9">@Model.Prazo.ToString("dd/MM/yyyy")</dd>

                <dt class="col-sm-3">Valor</dt>
                <dd class="col-sm-9">@Model.Valor.ToString("C")</dd>

                <dt class="col-sm-3">Forma de Pagamento</dt>
                <dd class="col-sm-9">@Model.FormaPagamento</dd>
            </dl>
        </div>
    </div>

    <!-- Botão que abre o modal -->
    <div class="d-flex gap-2">
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
            Excluir Ordem
        </button>
        <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
    </div>
</div>

<!-- Modal de confirmação -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="confirmDeleteLabel">Confirmar exclusão</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                Tem certeza que deseja excluir a ordem de serviço <strong>@Model.NomeProjeto</strong>?
                <small class="text-muted d-block mt-2">Esta ação não poderá ser desfeita.</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Voltar</button>

                <form asp-action="Delete" method="post" class="d-inline" id="deleteForm">
                    <input type="hidden" asp-for="Id" />
                    <button type="submit" class="btn btn-danger" id="confirmDeleteBtn">Excluir definitivamente</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (() => {
            const modal = document.getElementById('confirmDeleteModal');
            modal?.addEventListener('shown.bs.modal', () => {
                document.getElementById('confirmDeleteBtn')?.focus();
            });

            document.getElementById('deleteForm')?.addEventListener('submit', () => {
                const btn = document.getElementById('confirmDeleteBtn');
                if (btn) {
                    btn.disabled = true;
                    btn.innerText = 'Excluindo...';
                }
            });
        })();
    </script>
}
